# Code Reality Drift Report

**Last Updated**: Auto-updated by /ride command
**Project**: [Project Name]
**Generated By**: riding-codebase agent via /ride command

---

## Executive Summary

This report tracks drift between three sources of truth:
1. **Code Reality** - What actually exists in the codebase
2. **Documentation** - What is described in PRD/SDD/legacy docs
3. **User Context** - What stakeholders believe exists

### Drift Categories

- **Ghost Features**: Documented but not implemented (Strategic Liability)
- **Shadow Systems**: Implemented but not documented (Technical Debt)
- **Verified Features**: Code and docs align (Healthy State)
- **Resolved**: Previously flagged items that have been addressed

### Auto-Resolution

This report is automatically updated on:
- `/ride` command execution (full re-scan)
- `/update` command (checks for resolved items)
- Manual verification by agents

Items move to "Resolved" section when:
- Ghost Features are implemented or removed from docs
- Shadow Systems are documented or removed from code
- Re-scan confirms item no longer exists

---

## Strategic Liabilities (Ghost Features)

> **Definition**: Features documented in PRD/SDD but not implemented in code.
> **Detection Method**: Negative Grounding Protocol (two-query verification)
> **Risk**: Creates false expectations, wastes planning effort

| Feature | Doc Source | Search Evidence | Ambiguity | Beads ID | Action |
|---------|-----------|-----------------|-----------|----------|--------|
| _No ghost features detected_ | - | - | - | - | - |

### Classification Legend

- **Low Ambiguity**: 0 code results, 0-2 doc mentions → Confirmed ghost
- **High Ambiguity**: 0 code results, 3+ doc mentions → Human audit required

### Example Entry

```markdown
| OAuth2 SSO | PRD §3.2 | Q1: 0, Q2: 0 | Low | bd-123 | Remove from docs |
| Email Notifications | PRD §5.1 | Q1: 0, Q2: 0 | High (5 mentions) | - | **Human audit required** |
```

---

## Technical Debt (Shadow Systems)

> **Definition**: Code that exists but is undocumented in PRD/SDD.
> **Detection Method**: Shadow System Classifier (semantic similarity)
> **Risk**: Maintenance burden, knowledge silos, onboarding friction

| Module | Location | Classification | Risk | Dependents | Beads ID | Action |
|--------|----------|----------------|------|------------|----------|--------|
| _No shadow systems detected_ | - | - | - | - | - | - |

### Classification Legend

- **Orphaned** (< 0.3 similarity): No doc match → HIGH risk
- **Partial** (0.3 - 0.5 similarity): Incomplete docs → LOW risk
- **Drifted** (> 0.5 similarity): Docs exist but outdated → MEDIUM risk

### Example Entry

```markdown
| legacyHasher | src/auth/legacy.ts | Orphaned | HIGH | 3 files | bd-124 | **Urgent: Document or remove** |
| cacheUtils | src/utils/cache.ts | Drifted | MEDIUM | 12 files | - | Update PRD §4.3 |
| debugHelpers | src/dev/debug.ts | Partial | LOW | 1 file | - | Add to SDD §6.2 |
```

### Dependency Traces (Orphaned Systems Only)

When a Shadow System is classified as **Orphaned**, a dependency trace shows impact:

#### Example: legacyHasher

**Location**: `src/auth/legacy.ts`
**Similarity**: 0.15 (no doc match)
**Risk**: HIGH

**Dependent Files**:
1. `src/auth/handler.ts:23` - `import { hashLegacy } from './legacy'`
2. `src/users/service.ts:45` - `import { verifyLegacy } from '../auth/legacy'`
3. `src/admin/auth.ts:67` - `import { hashLegacy, verifyLegacy } from '../auth/legacy'`

**Recommendation**: Document legacy hashing algorithm rationale or migrate to standard library (e.g., bcrypt).

---

## Verified Features

> **Definition**: Features with confirmed implementation and documentation alignment.
> **Verification Method**: Semantic search finds code + docs with high similarity (>0.7)

| Feature | Documentation | Code Location | Confidence |
|---------|--------------|---------------|------------|
| _To be populated by /ride_ | - | - | - |

### Example Entry

```markdown
| JWT Authentication | PRD §3.1, SDD §5.2 | src/auth/jwt.ts:45 | 0.92 |
| Database Migrations | SDD §4.1 | src/db/migrate.ts:12 | 0.88 |
```

---

## Resolved (Auto-Updated)

> **Definition**: Previously flagged items that have been addressed.
> **Resolution Methods**: Implementation, documentation, removal, or verification

| Item | Type | Resolution Date | Evidence | Resolved By |
|------|------|-----------------|----------|-------------|
| _No resolved items yet_ | - | - | - | - |

### Example Entry

```markdown
| OAuth2 SSO | Ghost | 2025-01-15 | Implemented in src/auth/oauth.ts | implementing-tasks (Sprint 3) |
| legacyHasher | Shadow (Orphaned) | 2025-01-20 | Migrated to bcrypt, legacy removed | implementing-tasks (Sprint 4) |
| Email Notifications | Ghost | 2025-01-18 | Removed from PRD (deferred to v2.0) | discovering-requirements |
```

---

## Drift Metrics

### Summary Statistics

| Metric | Count | Percentage |
|--------|-------|------------|
| Total Features Analyzed | - | 100% |
| Verified Features | - | -% |
| Ghost Features | - | -% |
| Shadow Systems | - | -% |
| Resolved Items | - | -% |

### Risk Distribution

| Risk Level | Count | Action Required |
|------------|-------|-----------------|
| HIGH | - | Immediate attention |
| MEDIUM | - | Address in next sprint |
| LOW | - | Backlog |

### Drift Trend

_To be populated after multiple /ride executions_

| Date | Ghost Count | Shadow Count | Verified Count |
|------|-------------|--------------|----------------|
| 2025-12-27 | - | - | - |

---

## Beads Integration

When Beads (bd CLI) is installed, drift items are automatically tracked:

### Ghost Features → Liabilities

```bash
bd create "GHOST: OAuth2 SSO" \
    --type liability \
    --priority 2 \
    --metadata "doc_source=PRD_§3.2,queries=2,ambiguity=low"
```

### Shadow Systems → Technical Debt

```bash
bd create "SHADOW (orphaned): legacyHasher" \
    --type debt \
    --priority 1 \
    --metadata "file=src/auth/legacy.ts,similarity=0.15,dependents=3"
```

View all drift items in Beads:
```bash
bd list --type liability,debt
```

---

## Remediation Workflow

### For Ghost Features

1. **Confirm**: Re-run /ride to verify still a ghost
2. **Decide**:
   - **Implement**: Create sprint task via /implement
   - **Remove**: Update PRD/SDD to remove feature
   - **Defer**: Move to future version, add note
3. **Track**: Use Beads for prioritization
4. **Resolve**: Mark as resolved when addressed

### For Shadow Systems

1. **Classify**: Understand risk level (Orphaned/Drifted/Partial)
2. **Decide**:
   - **Document**: Add to PRD/SDD
   - **Remove**: If truly unused, deprecate and remove
   - **Refactor**: If duplicating existing functionality
3. **Track**: High-risk items get Beads tasks
4. **Resolve**: Mark as resolved when documented or removed

---

## Protocol References

- **Negative Grounding**: `.claude/protocols/negative-grounding.md`
- **Shadow Classification**: `.claude/protocols/shadow-classification.md`
- **Tool Result Clearing**: `.claude/protocols/tool-result-clearing.md`
- **Trajectory Evaluation**: `.claude/protocols/trajectory-evaluation.md`

---

## Change Log

| Date | Change | Agent |
|------|--------|-------|
| 2025-12-27 | Initial template created | implementing-tasks (Sprint 2) |

---

**Next Update**: Run `/ride` to populate this report with actual drift analysis.
