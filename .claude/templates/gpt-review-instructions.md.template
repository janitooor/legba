# GPT Review Protocol (MANDATORY)

GPT cross-model review is **enabled**. You MUST run GPT review at the appropriate workflow gates.

## Code Reviews (Ad-Hoc Changes)

After code changes (Edit/Write on code files), run GPT review **before moving on**:

```bash
.claude/scripts/gpt-review-api.sh code <changed-file>
```

- Not every single edit, but after each **logical group of changes** (completing a task, fixing a bug)
- This is NOT optional - do not skip or ignore

## Document Reviews (Workflow Phases)

### After PRD Generation (`/plan-and-analyze`)
```bash
.claude/scripts/gpt-review-api.sh prd grimoires/loa/prd.md
```

### After SDD Generation (`/architect`)
```bash
.claude/scripts/gpt-review-api.sh sdd grimoires/loa/sdd.md
```

### After Sprint Plan Generation (`/sprint-plan`)
```bash
.claude/scripts/gpt-review-api.sh sprint grimoires/loa/sprint.md
```

### After Task Implementation (`/implement`)
For each modified file:
```bash
.claude/scripts/gpt-review-api.sh code <file>
```

## Handling Verdicts

| Verdict | Action |
|---------|--------|
| `SKIPPED` | Continue (review disabled at phase level) |
| `APPROVED` | Continue (no issues found) |
| `CHANGES_REQUIRED` | Fix the issues, then re-run with iteration tracking |
| `DECISION_NEEDED` | Ask user via AskUserQuestion, then re-run (documents only) |

## Iteration Tracking (CRITICAL)

When re-reviewing after fixes, pass iteration context so GPT verifies fixes:

```bash
# Save first response
echo "$response" > /tmp/gpt-review-findings-1.json

# After fixing issues, run iteration 2+
.claude/scripts/gpt-review-api.sh <type> <file> \
  --iteration 2 \
  --previous /tmp/gpt-review-findings-1.json
```

Maximum 3 iterations per file. After iteration 3, auto-approve and proceed with warning.
